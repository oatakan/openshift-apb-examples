##############################################################################
## Deprovision nextcloud
## This role executes much of the needed functionality to deprovision an
## application using an Ansible Playbook Bundle and delete resources created
## in the sample apb generated by the provision role.
##############################################################################
- name: remove nextcloud route
  openshift_v1_route:
    name: nextcloud
    namespace: '{{ namespace }}'
    state: absent

- name: remove nginx-proxy service
  k8s_v1_service:
    name: nginx-proxy
    namespace: '{{ namespace }}'
    state: absent

- name: remove nextcloud service
  k8s_v1_service:
    name: nextcloud
    namespace: '{{ namespace }}'
    state: absent

- name: remove mysql service
  k8s_v1_service:
    name: mysql
    namespace: '{{ namespace }}'
    state: absent

- name: remove redis service
  k8s_v1_service:
    name: redis
    namespace: '{{ namespace }}'
    state: absent

- name: remove deployment config for nginx-proxy
  openshift_v1_deployment_config:
    name: nginx-proxy
    namespace: '{{ namespace }}'
    state: absent

- name: remove deployment config for nextcloud
  openshift_v1_deployment_config:
    name: nextcloud
    namespace: '{{ namespace }}'
    state: absent

- name: remove deployment config for mysql
  openshift_v1_deployment_config:
    name: mysql
    namespace: '{{ namespace }}'
    state: absent

- name: remove deployment config for redis
  openshift_v1_deployment_config:
    name: redis
    namespace: '{{ namespace }}'
    state: absent

- name: remove deployment config for solr
  openshift_v1_deployment_config:
    name: solr
    namespace: '{{ namespace }}'
    state: absent

- name: Delete configmap
  shell: oc delete configmap {{ item }} -n {{ namespace }}
  with_items:
  - temp-config-php
  - nginx-conf
  - ssl-config
  ignore_errors: yes

- name: remove persistent volume claims
  k8s_v1_persistent_volume_claim:
    name: '{{ item.name }}'
    namespace: '{{ namespace }}'
    state: absent
  with_items: '{{ persistent_volume_claims }}'

